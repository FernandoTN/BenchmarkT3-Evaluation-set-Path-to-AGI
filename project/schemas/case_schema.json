{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://t3benchmark.ai/schemas/case_schema.json",
  "title": "T3 Benchmark Case Schema",
  "description": "JSON Schema for validating T3 Benchmark cases for AI Safety evaluation",
  "type": "object",
  "required": [
    "case_id",
    "scenario",
    "variables",
    "annotations",
    "correct_reasoning",
    "wise_refusal",
    "is_original"
  ],
  "properties": {
    "case_id": {
      "type": "string",
      "pattern": "^8\\.[0-9]{1,3}$",
      "description": "Unique case identifier in format 8.XXX (e.g., 8.1, 8.123, 8.450)"
    },
    "scenario": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Description of the AI safety scenario being evaluated"
    },
    "variables": {
      "type": "object",
      "description": "Causal variables involved in the scenario",
      "required": ["X", "Y", "Z"],
      "properties": {
        "X": {
          "$ref": "#/definitions/variable"
        },
        "Y": {
          "$ref": "#/definitions/variable"
        },
        "Z": {
          "$ref": "#/definitions/variable"
        }
      },
      "additionalProperties": false
    },
    "annotations": {
      "type": "object",
      "description": "Metadata annotations for the case",
      "required": [
        "pearl_level",
        "domain",
        "trap_type",
        "trap_subtype",
        "difficulty",
        "subdomain",
        "causal_structure",
        "key_insight"
      ],
      "properties": {
        "pearl_level": {
          "type": "string",
          "enum": ["L1", "L2", "L3"],
          "description": "Pearl's Ladder of Causation level: L1 (Association), L2 (Intervention), L3 (Counterfactual)"
        },
        "domain": {
          "type": "string",
          "const": "D8",
          "description": "Domain identifier, fixed to D8 for this benchmark"
        },
        "trap_type": {
          "type": "string",
          "enum": [
            "GOODHART",
            "CONF_MED",
            "INSTRUMENTAL",
            "SELECTION",
            "SPURIOUS",
            "SPECIFICATION",
            "FEEDBACK",
            "COUNTERFACTUAL",
            "CLUSTERING",
            "COMPOSITION",
            "REGRESSION",
            "TRADE_OFF",
            "CALIBRATION",
            "INTERPRETABILITY",
            "ALIGNMENT",
            "MECHANISM",
            "METRIC",
            "ROBUSTNESS",
            "EXTRAPOLATION",
            "DISTRIBUTION_SHIFT"
          ],
          "description": "Type of reasoning trap or fallacy present in the case"
        },
        "trap_subtype": {
          "type": "string",
          "description": "Specific subtype or variant of the trap"
        },
        "difficulty": {
          "type": "string",
          "enum": ["Easy", "Medium", "Hard"],
          "description": "Difficulty level of the case"
        },
        "subdomain": {
          "type": "string",
          "description": "Specific subdomain within AI safety (e.g., healthcare, finance, autonomous systems)"
        },
        "causal_structure": {
          "type": "string",
          "description": "Directed Acyclic Graph notation representing causal relationships (e.g., X -> Y <- Z)"
        },
        "key_insight": {
          "type": "string",
          "description": "The core insight or lesson the case is designed to test"
        }
      },
      "additionalProperties": false
    },
    "correct_reasoning": {
      "type": "array",
      "description": "Steps of correct causal reasoning to solve the case",
      "items": {
        "type": "string"
      },
      "minItems": 1
    },
    "wise_refusal": {
      "type": "string",
      "minLength": 50,
      "description": "Example of an appropriate refusal or cautionary response when the case presents a flawed premise"
    },
    "is_original": {
      "type": "boolean",
      "description": "Whether this case is an original creation or derived from existing literature"
    },
    "original_case_ref": {
      "type": ["string", "null"],
      "description": "Reference to the original case if this is a derived or adapted case"
    },
    "hidden_structure": {
      "type": "string",
      "description": "Hidden causal structure not immediately apparent (required for L2 cases)"
    },
    "ground_truth": {
      "type": "object",
      "description": "Ground truth evaluation for counterfactual cases (required for L3 cases)",
      "required": ["verdict", "justification"],
      "properties": {
        "verdict": {
          "type": "string",
          "enum": ["VALID", "INVALID", "CONDITIONAL"],
          "description": "Whether the causal claim in the scenario is valid"
        },
        "justification": {
          "type": "string",
          "minLength": 20,
          "description": "Explanation supporting the verdict"
        }
      },
      "additionalProperties": false
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "annotations": {
            "properties": {
              "pearl_level": {
                "const": "L2"
              }
            }
          }
        }
      },
      "then": {
        "required": ["hidden_structure"]
      }
    },
    {
      "if": {
        "properties": {
          "annotations": {
            "properties": {
              "pearl_level": {
                "const": "L3"
              }
            }
          }
        }
      },
      "then": {
        "required": ["ground_truth"]
      }
    }
  ],
  "definitions": {
    "variable": {
      "type": "object",
      "description": "A causal variable with its name and role in the causal structure",
      "required": ["name", "role"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Human-readable name of the variable"
        },
        "role": {
          "type": "string",
          "enum": ["treatment", "outcome", "confounder", "mediator", "collider"],
          "description": "Causal role of the variable: treatment (intervention), outcome (effect), confounder (common cause), mediator (intermediate), collider (common effect)"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
